#!/bin/bash
set -x
#ls -R -a /opt/ml/input/data/
cd /work/
mkdir model
# Move model to right place
cp /opt/ml/input/data/model/model.tar.gz /work/model/model.tar.gz

# Teams can use any name of video, any type of video, so I need to know what it is somehow
cd /opt/ml/input/data/video
video=$(find -name *)
name=$(python3 /work/extension.py --file $video)
cp $video $name

# Untar model
cd /work/model
tar -xvf model.tar.gz
cd ..

python3 --version

# Annotate video
python3 test.py --modeldir=model --video=$name --graph=unoptimized.tflite

#Output annotated video
cp inference.avi  /opt/ml/model/output.avi